<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Escala BPRS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-size: 0.95rem;
    }
    h2, h4 {
      font-size: 1.3rem;
    }
    .table td, .table th {
      padding: 0.3rem 0.5rem;
      vertical-align: middle;
    }
    .form-select {
      padding: 0.25rem 0.5rem;
      font-size: 0.9rem;
      height: auto;
    }
    #total-score {
      font-size: 1.1rem;
      padding: 0.5rem 1rem;
    }
    button {
      padding: 0.4rem 1rem;
      font-size: 0.9rem;
    }
    canvas {
      max-height: 300px;
    }
  </style>
</head>
<body class="bg-light">

  <!-- CAPTURE ZONE: todo esto se incluir치 en la imagen -->
  <div class="container py-4" id="capture-zone">
    <div class="text-center mb-4">
      <!-- Si tienes un logo, col칩calo aqu칤 -->
      <!-- <img src="logo.png" alt="Logo" style="height: 60px;"> -->
      <h2 class="mb-1">Cl칤nica de Psiquiatr칤a - Escala BPRS</h2>
      <p class="mb-0"><strong>Dr. Mauricio Villamandos</strong></p>
      <p>九괦잺 infopsicodinamyc@gmail.com | 游 3765 041832</p>
    </div>

    <form id="bprs-form">
      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-dark">
            <tr>
              <th>S칤ntoma</th>
              <th class="text-center">Puntuaci칩n (0-7)</th>
            </tr>
          </thead>
          <tbody id="symptom-table-body"></tbody>
        </table>

        <canvas id="bprs-chart" height="100"></canvas>
      </div>
    </form>
  </div>

  <!-- Zona inferior: fuera de la imagen -->
  <div class="container text-center my-3">
    <h4>Puntuaci칩n Total: <span class="badge bg-primary fs-5" id="total-score">0</span></h4>
    <button onclick="exportToImage()" class="btn btn-success mt-3">游닞 Exportar como imagen</button>
  </div>

  <script>
    const symptoms = [
      "Retraimiento emocional", "Ansiedad", "Sentimiento de culpa", "Tensi칩n",
      "Manejo pobre de la realidad", "Conducta extra침a", "Pensamiento conceptual extra침o",
      "Grandiosidad", "Hostilidad", "Suspiciosidad", "Alucinaciones", "Excitaci칩n",
      "Lenguaje incoherente", "Comportamiento motor", "Desorientaci칩n",
      "S칤ntomas som치ticos", "Conducta suicida", "Afecto embotado"
    ];

    const tbody = document.getElementById('symptom-table-body');
    symptoms.forEach((symptom, index) => {
      const id = `symptom-${index}`;
      const row = `
        <tr>
          <td>${index + 1}. ${symptom}</td>
          <td class="text-center">
            <select class="form-select text-center" id="${id}" onchange="updateBPRS()" style="max-width: 100px; margin: 0 auto;">
              ${Array.from({ length: 8 }, (_, i) => `<option value="${i}">${i}</option>`).join('')}
            </select>
          </td>
        </tr>
      `;
      tbody.insertAdjacentHTML('beforeend', row);
    });

    const ctx = document.getElementById('bprs-chart').getContext('2d');
    const bprsChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: symptoms.map((_, i) => `S${i + 1}`),
        datasets: [{
          label: 'Puntuaci칩n por s칤ntoma',
          data: new Array(symptoms.length).fill(0),
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          fill: true,
          tension: 0.3,
          pointRadius: 5,
          pointBackgroundColor: 'rgba(75, 192, 192, 1)'
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            max: 7,
            title: {
              display: true,
              text: 'Puntuaci칩n'
            }
          },
          x: {
            title: {
              display: true,
              text: 'S칤ntomas'
            }
          }
        }
      }
    });

    function updateBPRS() {
      const scores = [];
      let total = 0;

      symptoms.forEach((_, i) => {
        const val = parseInt(document.getElementById(`symptom-${i}`).value);
        scores.push(val);
        total += val;
      });

      document.getElementById('total-score').textContent = total;
      bprsChart.data.datasets[0].data = scores;
      bprsChart.update();
    }

    function exportToImage() {
      const captureZone = document.getElementById('capture-zone');
      html2canvas(captureZone).then(canvas => {
        const link = document.createElement('a');
        link.download = 'bprs_resultado.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    updateBPRS();
  </script>
</body>
</html>


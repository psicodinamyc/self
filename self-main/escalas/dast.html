<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario DAST - Versión Digital</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .header-card {
            margin-bottom: 2rem;
        }
        .question-card {
            margin-bottom: 1.5rem;
            border-left: 4px solid #0d6efd;
        }
        .question-text {
            font-weight: 500;
        }
        .results-card {
            position: sticky;
            top: 20px;
        }
        .score-display {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 1rem 0;
        }
        .interpretation-card {
            margin-top: 1.5rem;
        }
        .risk-level {
            font-weight: bold;
            padding: 0.5rem;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }
        .risk-0 {
            background-color: #d1e7dd;
            color: #0f5132;
        }
        .risk-1 {
            background-color: #fff3cd;
            color: #664d03;
        }
        .risk-2 {
            background-color: #ffecb5;
            color: #664d03;
        }
        .risk-3 {
            background-color: #f8d7da;
            color: #842029;
        }
        .chart-container {
            position: relative;
            height: 200px;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <div class="row">
            <div class="col-lg-8">
                <div class="card header-card">
                    <div class="card-body">
                        <h1 class="card-title text-center mb-4">Cuestionario de Detección de Drogas (DAST)</h1>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="patientName" class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="patientName">
                            </div>
                            <div class="col-md-3">
                                <label for="patientDni" class="form-label">DNI</label>
                                <input type="text" class="form-control" id="patientDni">
                            </div>
                            <div class="col-md-3">
                                <label for="patientDate" class="form-label">Fecha</label>
                                <input type="date" class="form-control" id="patientDate">
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <strong>Instrucciones:</strong> El uso de drogas puede afectar su salud y a algunos medicamentos que podría estar consumiendo. Ayúdenos a darle la mejor atención médica contestando a las siguientes preguntas. Recuerde que esta escala solo es un instrumento aislado y debe ser correlacionado con una evaluación clínica profesional.
                        </div>
                    </div>
                </div>

                <!-- Preguntas del DAST -->
                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">1. ¿Ha consumido drogas distintas a las requeridas por razones médicas?</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q1" id="q1-yes" value="1">
                            <label class="form-check-label" for="q1-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q1" id="q1-no" value="0">
                            <label class="form-check-label" for="q1-no">No</label>
                        </div>
                    </div>
                </div>

                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">2. ¿Abusa de más de un tipo de droga en un mismo día?</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q2" id="q2-yes" value="1">
                            <label class="form-check-label" for="q2-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q2" id="q2-no" value="0">
                            <label class="form-check-label" for="q2-no">No</label>
                        </div>
                    </div>
                </div>

                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">3. ¿Es capaz de dejar de consumir drogas cuando lo desea? (Puntuación invertida: No = 1 punto)</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q3" id="q3-yes" value="0">
                            <label class="form-check-label" for="q3-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q3" id="q3-no" value="1">
                            <label class="form-check-label" for="q3-no">No</label>
                        </div>
                    </div>
                </div>

                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">4. ¿Ha tenido lagunas mentales o pérdidas de memoria como resultado del consumo de drogas?</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q4" id="q4-yes" value="1">
                            <label class="form-check-label" for="q4-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q4" id="q4-no" value="0">
                            <label class="form-check-label" for="q4-no">No</label>
                        </div>
                    </div>
                </div>

                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">5. ¿Sus familiares o amigos alguna vez se han preocupado o quejado por su consumo de drogas?</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q5" id="q5-yes" value="1">
                            <label class="form-check-label" for="q5-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q5" id="q5-no" value="0">
                            <label class="form-check-label" for="q5-no">No</label>
                        </div>
                    </div>
                </div>

                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">6. ¿Ha tenido problemas financieros como resultado de su consumo de drogas?</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q6" id="q6-yes" value="1">
                            <label class="form-check-label" for="q6-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q6" id="q6-no" value="0">
                            <label class="form-check-label" for="q6-no">No</label>
                        </div>
                    </div>
                </div>

                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">7. ¿Ha intentado alguna vez reducir o dejar el consumo de drogas y no lo ha logrado?</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q7" id="q7-yes" value="1">
                            <label class="form-check-label" for="q7-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q7" id="q7-no" value="0">
                            <label class="form-check-label" for="q7-no">No</label>
                        </div>
                    </div>
                </div>

                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">8. ¿Ha consumido drogas por vía intravenosa?</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q8" id="q8-yes" value="1">
                            <label class="form-check-label" for="q8-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q8" id="q8-no" value="0">
                            <label class="form-check-label" for="q8-no">No</label>
                        </div>
                    </div>
                </div>

                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">9. ¿Ha tenido síntomas de abstinencia cuando ha dejado de consumir drogas?</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q9" id="q9-yes" value="1">
                            <label class="form-check-label" for="q9-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q9" id="q9-no" value="0">
                            <label class="form-check-label" for="q9-no">No</label>
                        </div>
                    </div>
                </div>

                <div class="card question-card">
                    <div class="card-body">
                        <h5 class="question-text">10. ¿Ha tenido problemas legales relacionados con su consumo de drogas?</h5>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q10" id="q10-yes" value="1">
                            <label class="form-check-label" for="q10-yes">Sí</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input dast-question" type="radio" name="q10" id="q10-no" value="0">
                            <label class="form-check-label" for="q10-no">No</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Columna de resultados -->
            <div class="col-lg-4">
                <div class="card results-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">Resultados DAST</h5>
                    </div>
                    <div class="card-body">
                        <div class="score-display">
                            <span id="dast-score">0</span>
                            <div class="text-muted small">Puntuación total</div>
                        </div>

                        <div class="interpretation-card card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Interpretación</h6>
                            </div>
                            <div class="card-body">
                                <div id="interpretation-text">
                                    <p class="text-muted">Complete el cuestionario para ver la interpretación.</p>
                                </div>
                                
                                <div id="risk-level-0" class="risk-level risk-0 d-none">
                                    <strong>Zona I - Sin riesgo</strong><br>
                                    Sin riesgo de problemas de salud relacionados.
                                </div>
                                
                                <div id="risk-level-1" class="risk-level risk-1 d-none">
                                    <strong>Zona II - Riesgoso</strong><br>
                                    Riesgo de problemas de salud relacionados con el consumo de drogas.
                                </div>
                                
                                <div id="risk-level-2" class="risk-level risk-2 d-none">
                                    <strong>Zona III - Nocivo</strong><br>
                                    Riesgo de problemas de salud y posible trastorno por consumo de sustancias leve o moderado.
                                </div>
                                
                                <div id="risk-level-3" class="risk-level risk-3 d-none">
                                    <strong>Zona IV - Grave</strong><br>
                                    Riesgo de problemas de salud y posible trastorno por consumo de sustancias moderado o grave.
                                </div>
                            </div>
                        </div>

                        <div class="interpretation-card card mt-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Acción recomendada</h6>
                            </div>
                            <div class="card-body">
                                <div id="action-text">
                                    <p class="text-muted">Complete el cuestionario para ver las recomendaciones.</p>
                                </div>
                                
                                <div id="action-0" class="d-none">
                                    <p>Ninguna acción requerida.</p>
                                </div>
                                
                                <div id="action-1" class="d-none">
                                    <p><strong>Educación breve:</strong> Informar sobre los beneficios de abstenerse del consumo de drogas. Monitorizar en futuras visitas.</p>
                                    <p><strong>Intervención breve:</strong> Charla centrada en el paciente usando conceptos de Entrevista Motivacional.</p>
                                </div>
                                
                                <div id="action-2" class="d-none">
                                    <p><strong>Intervención breve:</strong> Ofrecer opciones que incluyan tratamiento.</p>
                                </div>
                                
                                <div id="action-3" class="d-none">
                                    <p><strong>Intervención breve:</strong> Ofrecer opciones que incluyan tratamiento.</p>
                                    <p><strong>Derivación:</strong> Considerar derivación a especialistas en tratamiento de drogas para evaluación completa.</p>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container mt-3">
                            <canvas id="dastChart"></canvas>
                        </div>

                        <button id="print-btn" class="btn btn-primary w-100 mt-2">
                            <i class="bi bi-printer-fill"></i> Imprimir o Guardar
                        </button>
                        
                        <button id="reset-btn" class="btn btn-outline-secondary w-100 mt-2">
                            <i class="bi bi-arrow-counterclockwise"></i> Reiniciar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar gráfico
            const ctx = document.getElementById('dastChart').getContext('2d');
            const dastChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Puntuación DAST'],
                    datasets: [{
                        label: 'Puntuación',
                        data: [0],
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });

            // Calcular puntuación cuando cambia cualquier radio button
            const radioButtons = document.querySelectorAll('.dast-question');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', calculateDASTScore);
            });

            // Botón de reinicio
            document.getElementById('reset-btn').addEventListener('click', function() {
                if(confirm('¿Estás seguro de que quieres reiniciar todos los valores?')) {
                    radioButtons.forEach(radio => {
                        radio.checked = false;
                    });
                    calculateDASTScore();
                    
                    // Limpiar datos del paciente
                    document.getElementById('patientName').value = '';
                    document.getElementById('patientDni').value = '';
                    document.getElementById('patientDate').value = '';
                }
            });

            // Botón de imprimir
            document.getElementById('print-btn').addEventListener('click', function() {
                window.print();
            });

            // Función para calcular la puntuación DAST
            function calculateDASTScore() {
                let score = 0;
                
                // Sumar puntos de las preguntas (la 3 tiene puntuación invertida)
                document.querySelectorAll('.dast-question:checked').forEach(item => {
                    score += parseInt(item.value);
                });
                
                // Actualizar puntuación
                document.getElementById('dast-score').textContent = score;
                dastChart.data.datasets[0].data = [score];
                dastChart.update();
                
                // Actualizar interpretación
                updateInterpretation(score);
            }

            // Función para actualizar la interpretación según la puntuación
            function updateInterpretation(score) {
                // Ocultar todos los niveles de riesgo primero
                document.querySelectorAll('[id^="risk-level-"], [id^="action-"]').forEach(el => {
                    el.classList.add('d-none');
                });
                
                // Mostrar el nivel de riesgo correspondiente
                let riskLevel = 0;
                let actionLevel = 0;
                
                if (score === 0) {
                    riskLevel = 0;
                    actionLevel = 0;
                } else if (score >= 1 && score <= 2) {
                    riskLevel = 1;
                    actionLevel = 1;
                } else if (score >= 3 && score <= 5) {
                    riskLevel = 2;
                    actionLevel = 2;
                } else if (score >= 6) {
                    riskLevel = 3;
                    actionLevel = 3;
                }
                
                document.getElementById(`risk-level-${riskLevel}`).classList.remove('d-none');
                document.getElementById(`action-${actionLevel}`).classList.remove('d-none');
                
                // Actualizar texto de interpretación
                const interpretationText = document.getElementById('interpretation-text');
                const actionText = document.getElementById('action-text');
                
                if (score === 0) {
                    interpretationText.innerHTML = '<p>Sin riesgo de problemas de salud relacionados con el consumo de drogas.</p>';
                } else {
                    interpretationText.innerHTML = '';
                }
            }
        });
    </script>
</body>
</html>